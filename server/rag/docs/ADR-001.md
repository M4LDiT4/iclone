# ADR-001: Backend Stack Selection for RAG Server

## Status

Accepted

---

## Context

The project aims to build a **server-side Retrieval-Augmented Generation (RAG) system** that is:

* Documentation-first
* Secure by default
* Scalable to multiple tenants
* Maintainable as the system evolves

The server must:

* Expose HTTP APIs for querying and ingesting documents
* Orchestrate embeddings, retrieval, and LLM generation
* Support tenant-isolated vector search
* Be deployable locally and in the cloud

Tooling choices must align with the documented architecture and allow future changes with minimal refactoring.

---

## Decision

We decided to use the following core technologies:

* **FastAPI (Python)** as the backend API framework
* **Docker** for containerization and deployment
* **Pinecone** as the managed vector database
* **Firebase Auth** as the authentication provider (JWT-based)
* **External LLM and embedding providers** accessed via adapters

---

## Rationale

### FastAPI

FastAPI was selected because it:

* Provides native async support, suitable for I/O-bound operations (LLMs, vector DBs)
* Encourages clear separation between API, application, and domain layers
* Automatically generates OpenAPI documentation, supporting a documentation-first approach
* Integrates cleanly with dependency injection and middleware (auth, tenant resolution)

---

### Docker

Docker was selected to:

* Ensure consistent environments across development, testing, and production
* Simplify local development and onboarding
* Support future deployment targets without architectural changes

---

### Pinecone (Vector Database)

Pinecone was selected because it:

* Provides managed, production-grade vector similarity search
* Supports metadata-based filtering required for multi-tenant isolation
* Eliminates operational overhead of managing vector indices
* Scales independently of the application server

---

### Firebase Auth

Firebase Auth was selected to:

* Provide secure JWT-based authentication
* Act as a single source of truth for user identity
* Enable stateless authentication in FastAPI
* Support OAuth, email/password, and other login methods without custom implementation

FastAPI will verify Firebase-issued JWTs and perform tenant resolution and authorization using a trusted backend database. The JWT is used strictly for identity verification; the server enforces authorization and tenant isolation.

---

### Adapter-based External Services

LLMs, embedding models, and vector databases are accessed via adapters to:

* Avoid tight coupling to specific vendors
* Enable future replacement or hybrid setups (e.g., local embeddings)
* Preserve clean architecture boundaries

---

## Consequences

### Positive Consequences

* Clear alignment between architecture documentation and implementation
* Strong security posture through server-side enforcement
* Easy scaling to multi-tenant usage
* Improved maintainability and testability
* Straightforward future upgrades (LLM, vector DB, auth provider)

---

### Negative Consequences / Trade-offs

* Reliance on managed services introduces external dependencies
* Pinecone usage incurs operational cost
* JWT-based auth requires careful token lifecycle management
* Python async code introduces some complexity

These trade-offs are acceptable given the project goals.

---

## Alternatives Considered

### Node.js (NestJS)

* Pros: Strong structure, TypeScript safety
* Cons: Less native alignment with ML/LLM tooling

---

### Self-hosted Vector Databases (FAISS, Chroma)

* Pros: Lower cost, full control
* Cons: Operational overhead, limited scalability

---

### Monolithic Auth + Business Logic

* Rejected due to poor separation of concerns and security risks

---

## Related Documents

* RAG Server Architecture Document
* ADR-002: Multi-Tenancy Strategy (planned)
* ADR-003: Authentication & Tenant Resolution (planned)

---

## Notes

This ADR establishes the **baseline technology stack**, now explicitly including Firebase Auth for secure identity management. All future architectural decisions should assume this stack unless explicitly revised via a new ADR.
